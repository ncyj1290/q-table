<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.qtable.mapper.mypage.PaymentListMapper">
	
    <!-- 결제 관련 select -->
	<select id="getMyPaymentList" resultType="map">
		SELECT
		  p.payment_idx,
		  p.payment_amount,
		  p.payment_date,
		  p.pay_way,
		  p.pay_type,
		  s.store_idx,
		  s.store_name,
		  s.store_content,
		  s.store_phone,
		  s.full_address,
		  (SELECT image_url
		     FROM image
		    WHERE target_type = 'imguse_01'
		      AND target_idx = s.store_idx
		    LIMIT 1) AS store_img,
		  CONCAT(rv.reserve_date, ' ', rv.reserve_time) AS reserve_dt,
		  rv.reserve_result
		FROM payment p
		LEFT JOIN reservation rv 
		  ON p.reference_idx = rv.reserve_idx 
		LEFT JOIN store s 
		  ON rv.store_idx = s.store_idx
		WHERE p.member_idx = #{member_idx}
		  AND (p.pay_status = 'pyst_01' OR p.pay_type = 'pyus_04')
		ORDER BY p.payment_date DESC
	</select>







	
	
	
	

	
</mapper>