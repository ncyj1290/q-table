<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{common/layouts/defaultLayout}">
<head>
    <title>1대1 문의 페이지</title>
    <link rel="stylesheet" th:href="@{/css/chat/chat.css}">
    <!-- STOMP & SockJS 라이브러리 (WebSocket 통신용) -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script th:src="@{/js/chat/chat.js}"></script>
</head>
<body>
<div layout:fragment="Content">
	<!-- 현재 사용자 ID (JavaScript에서 사용) -->
	<div th:if="${#authentication != null}" th:data-current-user-idx="${#authentication.principal.member.memberIdx}" style="display: none;"></div>

	<!-- 페이지 헤더 텍스트 -->
	<div class="chat-page-header">
		<h1>Q-Talk</h1>
	</div>
	
	<!-- 메인 콘텐츠 전체 영역 -->
	<div class="chat-main-container">
	
		<!-- 좌측 사이드바 영역 -->
		<div class="chat-sidebar">
			<!-- 검색바 영역 -->
			<div class="chat-search-section">
				<input type="text" class="component-write" placeholder="메시지 검색">
			</div>

			<!-- 채팅방 리스트 영역 -->
			<div class="chat-room-list" id="chatRoomList">
				<th:block th:if="${chatRoomList != null and chatRoomList.size() > 0}">
					<th:block th:each="room : ${chatRoomList}">
						<div class="chat-room-item" th:data-room-id="${room.room_idx}" th:data-store-id="${room.store_idx}">
							<div class="chat-room-profile">
							</div>
							<div class="chat-room-info">
								<div class="chat-room-name" th:text="${room.opposite_name != null ? room.opposite_name : '알 수 없는 사용자'}">상대방</div>
								<div class="chat-room-last-message" th:text="${room.lastMsg != null ? room.lastMsg : ''}"></div>
							</div>
							<div class="chat-room-badge">
								<span class="unread-count" th:text="${room.unreadCount != null ? room.unreadCount : 0}" th:style="${(room.unreadCount == null or room.unreadCount == 0) ? 'display:none' : ''}"></span>
							</div>
						<div class="horizontal-line"></div>
						</div>
						
					</th:block>
				</th:block>
				<th:block th:if="${chatRoomList == null or chatRoomList.size() == 0}">
					<div style="padding: 20px; text-align: center; color: #999;">
						채팅방이 없습니다.
					</div>
				</th:block>
			</div>
		</div>
		
		<!-- 우측 대화창 영역 -->
		<div class="chat-content-area">
			<div class="chat-content-header">
				<h3>Q-Talk</h3>
			</div>
			<div class="chat-messages-area">
				<!-- 초기 상태: 채팅방 선택 유도 -->
				<div class="empty-state">
					<i class="fas fa-comments"></i>
					<h2>채팅방을 선택해주세요</h2>
					<p>좌측 채팅방 목록에서 대화를 시작하세요</p>
				</div>
			</div>

			<!-- 이미지 미리보기 영역 -->
			<div class="image-preview-area" style="display: none; padding: 10px; background: #f5f5f5; border-top: 1px solid #ddd;">
				<div id="previewContainer" style="display: flex; gap: 10px; flex-wrap: wrap;">
					<!-- 미리보기 이미지들이 여기에 추가됨 -->
				</div>
			</div>

			<div class="chat-input-area">
				<div class="message-input-container">
					<input type="text" class="chat-message-input" placeholder="메시지 입력">
					<i class="fas fa-image attachment-icon"></i>
					<input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
				</div>
				<button class="positive-button" id="send-btn">전송</button>
			</div>
		</div>
	</div>

	<!-- 이미지 확대 모달 -->
	<div id="imageModal">
		<span class="close-modal">&times;</span>
		<img id="modalImage">
	</div>

</div>

</body>
</html>